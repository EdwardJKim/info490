## Problem 1. SQLite.

- There is no template.
- You must submit a text file named `Firstname_Lastname_airport.sql`
  via Moodle.

There are five major tasks in this problem:

1. CREATE a table named `flights`, import `2001.csv`,
2. CREATE another table `airports`, import `airports.csv`,
3. JOIN `flights` and `airports` by matching the IATA code,
4. INSERT a new row in the table, and
5. SELECT query.

### CLI

In this problem, we will use the _SQLite_ command line tool to perform some
  simple database tasks. There are two ways to use the _SQLite_ command line
  tool. You can either simply do

```shell
  SQLite version 3.8.2 2013-12-06 14:53:30
  Enter ".help" for instructions
  Enter SQL statements terminated with a ";"
  sqlite> 
  ```

which brings up an interactive prompt, where you can enter SQL
  commands line by line; or you can write an SQL script in text
  file format (e.g. `airport.sql`), and run it from the command
  line with 

```shell
  $ sqlite3 mydatabase.db < airport.sql
```

You might find it easier to practice and debug using the
  first option, but for submission, you will have to write an
  SQL script and make sure that the second method works.

Before we begin, I will give you another tip. The `2001.csv` file is
  a large file, so if test your code on the entire data set
  every time you change something in your code, you will have lots
  of idle time waiting for the flights data to be imported.
  Use `awk` or `head` to create a smaller file,
  or use interactive mode to load the data set once and try different
  commands.
  When you are satisfied, write your commands in a text file and
  test it on `2001.csv`.

### Creating a new table

- Use the provided schema [flights.sql](flights.sql) and `2001.csv`
  to create a new table named `flights`.
- Count the number of rows in the `flights` table. You should get

```text
  5967780
```

- Compute the maximum of `departureDelay` column. You should get

```text
  1692
```

- Compute the minimum of `departureDelay` column. You should get

```text
  -204
```

#### Hints

1. After creating a new table, check the first ten lines with

```sqlite3
  SELECT * FROM flights LIMIT 10;
```

You will likely find that the column headers have also been imported.
  You can remove the headers with this sql:

```sqlite3
  DELETE FROM flights WHERE TYPEOF(year) == "text";
```

### Creating another table

- Write your own schema to import [airports.csv](airports.csv)
  (available on GitHub) and create a new table named `airports`.
  The names of the columns should be

```text
airportID, name, city, country, iata, icao, latitude, longitude, altitude, timeZone, dst, tzDatabaseTimeZone
```

  This data set is from [OpenFlights.org](http://openflights.org/data.html),
  where you can find the description for each column.

- Count the number of rows in the `airports` table. You should get

```text
  5967780
```

#### Hints

1. It is important that you do not make any typos when naming the columns.
   To check if you didn't make any typos in the schema, do

```shell
   $ sqlite3 mydatabase.db "PRAGMA table_info(airports)" > output
   $ diff output airports_table_info.txt
```

If there is no output, it means that your schema is correct.
   If there are any typos, the `diff` will point to the line(s) that
   contains the typo(s). [airports\_table\_info.txt](airports_table_info.txt) is available on GitHub.

2. It is also important that your data types are all correct.
   Use `head` or otherwise to check the CSV file. If a value is enclosed
   by quotation marks, it should be a `TEXT`. If a field has a decimal point,
   it should be a `REAL`. If a field is a number with no decimal point,
   it should be an `INT`.

### Joining tables

- Join `flights` and `airports` by matching the IATA codes of **both**
  `originCode` and `destinationCode`. Combine them into a new table
  named `myTable`, which should have the following columns:

```text
  month, dayOfMonth, uniqueCarrierCode, flightNumber, scheduledDepartureTime,
  diverted, originCity, destinationCity
```

The `originCity` comes from matching the `originCode` in `flights`
  with the `iata` column in `airports`, and `destinationCode` comes from
  the `destinationCode`.

- Count the number of rows in `myTable`. You should get

```text
5967780
```

#### Hints

1. You can use a
   [`CREATE TABLE ...  AS SELECT`](https://www.sqlite.org/lang_createtable.html)   statement.

2. Use [Alias](http://en.wikipedia.org/wiki/Alias_%28SQL%29) to rename the
   columns.

3. There are several types of SQL
   [`JOIN`s](http://en.wikipedia.org/wiki/Join_%28SQL%29).
   The resulting table should contain all records in `flights`
   even if there is no matching record in `airports`. Use the appropriate
   JOIN clause.

### Inserting

- Insert a new row into `myTable`. This flight
  - took place on September 9, 2001,
  - its `uniqueCarrierCode` was `INFO`,
  - its `flightNumber` was `490`,
  - its `scheduledDepartureTime` was `0800`,
  - was diverted (i.e. `diverted == 1`),
  - left from `Champaign`, and
  - arrived at `Chicago`.

- Count the number of rows in `myTable` after inserting a new row.
  You should get


```text
  5967781
```

#### Hint

No hint for this one.

### Query

- Finally, find every flight in 2001 that
  - was scheduled to depart between `0745` and `0815`,
  - left from `Newark`,
  - was scheduled to arrive at `San Francisco`, and 
  - was diverted (i.e. `diverted == 1`).
  and display
  - `Month`, `dayOfMonth`, `uniqueCarrierCode`, and `flightNumber`.

You should get

```text
9,11,UA,93
```

### Summary

To summarize, when you do

```shell
$ sqlite3 test < airport.sql
```

You should get

```text
5967780
1692
-204
8107
5967780
5967781
9,11,UA,93
```

